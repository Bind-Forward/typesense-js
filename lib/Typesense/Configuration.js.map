{"version":3,"sources":["Typesense/Configuration.js"],"names":["Configuration","options","nodes","map","node","_setDefaultPathInNode","_setDefaultPortInNode","nearestNode","connectionTimeoutSeconds","timeoutSeconds","healthcheckIntervalSeconds","numRetries","length","retryIntervalSeconds","apiKey","logger","logLevel","setLevel","_showDeprecationWarnings","validate","_validateNodes","MissingConfigurationError","_isNodeMissingAnyParameters","some","every","key","hasOwnProperty","path","protocol","port","warn","masterNode","readReplicaNodes"],"mappings":"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","sourcesContent":["'use strict'\n\nimport logger from 'loglevel'\nimport {MissingConfigurationError} from './Errors'\n\nexport default class Configuration {\n  constructor (options = {}) {\n    this.nodes = options.nodes || []\n    this.nodes = this.nodes\n      .map(node => this._setDefaultPathInNode(node))\n      .map(node => this._setDefaultPortInNode(node))\n    this.nearestNode = options.nearestNode || null\n    this.nearestNode = this._setDefaultPathInNode(this.nearestNode)\n    this.nearestNode = this._setDefaultPortInNode(this.nearestNode)\n    this.connectionTimeoutSeconds = options.connectionTimeoutSeconds || options.timeoutSeconds || 10\n    this.healthcheckIntervalSeconds = options.healthcheckIntervalSeconds || 15\n    this.numRetries = options.numRetries || this.nodes.length + (this.nearestNode == null ? 0 : 1) || 3\n    this.retryIntervalSeconds = options.retryIntervalSeconds || 0.1\n    this.apiKey = options.apiKey\n\n    this.logger = options.logger || logger\n    this.logLevel = options.logLevel || 'warn'\n    this.logger.setLevel(this.logLevel)\n\n    this._showDeprecationWarnings(options)\n    this.validate()\n  }\n\n  validate () {\n    if (this.nodes == null || this.nodes.length === 0 || this._validateNodes()) {\n      throw new MissingConfigurationError('Ensure that nodes[].protocol, nodes[].host and nodes[].port are set')\n    }\n\n    if (this.nearestNode != null && this._isNodeMissingAnyParameters(this.nearestNode)) {\n      throw new MissingConfigurationError('Ensure that nearestNodes.protocol, nearestNodes.host and nearestNodes.port are set')\n    }\n\n    if (this.apiKey == null) {\n      throw new MissingConfigurationError('Ensure that apiKey is set')\n    }\n\n    return true\n  }\n\n  _validateNodes () {\n    return this.nodes.some((node) => {\n      return this._isNodeMissingAnyParameters(node)\n    })\n  }\n\n  _isNodeMissingAnyParameters (node) {\n    return !['protocol', 'host', 'port', 'path'].every((key) => {\n      return node.hasOwnProperty(key)\n    })\n  }\n\n  _setDefaultPathInNode (node) {\n    if (node != null && !node.hasOwnProperty('path')) {\n      node.path = ''\n    }\n    return node\n  }\n\n  _setDefaultPortInNode (node) {\n    if (node != null && !node.hasOwnProperty('port') && node.hasOwnProperty('protocol')) {\n      switch (node.protocol) {\n        case 'https':\n          node.port = 443\n          break\n        case 'http':\n          node.port = 80\n          break\n      }\n    }\n    return node\n  }\n\n  _showDeprecationWarnings (options) {\n    if (options.timeoutSeconds) {\n      this.logger.warn('Deprecation warning: timeoutSeconds is now renamed to connectionTimeoutSeconds')\n    }\n    if (options.masterNode) {\n      this.logger.warn('Deprecation warning: masterNode is now consolidated to nodes, starting with Typesense Server v0.12')\n    }\n    if (options.readReplicaNodes) {\n      this.logger.warn('Deprecation warning: readReplicaNodes is now consolidated to nodes, starting with Typesense Server v0.12')\n    }\n  }\n}\n"],"file":"Configuration.js"}