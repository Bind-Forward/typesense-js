{"version":3,"sources":["Typesense/Configuration.js"],"names":["Configuration","options","nodes","map","node","hasOwnProperty","path","connectionTimeoutSeconds","timeoutSeconds","healthcheckIntervalSeconds","numRetries","length","retryIntervalSeconds","apiKey","logger","logLevel","setLevel","_showDeprecationWarnings","validate","_validateNodes","Error","some","_isNodeMissingAnyParameters","every","key","_logger","warn","masterNode","readReplicaNodes","module","exports"],"mappings":"AAAA;;;;;;;;AAEA;;IAEMA,a;AACJ,2BAA2B;AAAA,QAAdC,OAAc,uEAAJ,EAAI;AAAA;AACzB,SAAKC,KAAL,GAAaD,OAAO,CAACC,KAAR,IAAiB,EAA9B;AACA,SAAKA,KAAL,GAAa,KAAKA,KAAL,CAAWC,GAAX,CAAe,UAACC,IAAD,EAAU;AACpC,UAAI,CAACA,IAAI,CAACC,cAAL,CAAoB,MAApB,CAAL,EAAkC;AAChCD,QAAAA,IAAI,CAACE,IAAL,GAAY,EAAZ;AACD;;AACD,aAAOF,IAAP;AACD,KALY,CAAb;AAMA,SAAKG,wBAAL,GAAgCN,OAAO,CAACM,wBAAR,IAAoCN,OAAO,CAACO,cAA5C,IAA8D,EAA9F;AACA,SAAKC,0BAAL,GAAkCR,OAAO,CAACQ,0BAAR,IAAsC,EAAxE;AACA,SAAKC,UAAL,GAAkBT,OAAO,CAACS,UAAR,IAAsB,KAAKR,KAAL,CAAWS,MAAjC,IAA2C,CAA7D;AACA,SAAKC,oBAAL,GAA4BX,OAAO,CAACW,oBAAR,IAAgC,GAA5D;AACA,SAAKC,MAAL,GAAcZ,OAAO,CAACY,MAAtB;AAEA,SAAKC,MAAL,GAAcb,OAAO,CAACa,MAAR,IAAkBA,iBAAhC;AACA,SAAKC,QAAL,GAAgBd,OAAO,CAACc,QAAR,IAAoB,MAApC;AACA,SAAKD,MAAL,CAAYE,QAAZ,CAAqB,KAAKD,QAA1B;;AAEA,SAAKE,wBAAL,CAA8BhB,OAA9B;;AACA,SAAKiB,QAAL;AACD;;;;+BAEW;AACV,UAAI,KAAKhB,KAAL,IAAc,IAAd,IAAsB,KAAKA,KAAL,CAAWS,MAAX,KAAsB,CAA5C,IAAiD,KAAKQ,cAAL,EAArD,EAA4E;AAC1E,cAAM,IAAIC,KAAJ,CAAU,sGAAV,CAAN;AACD;;AAED,UAAI,KAAKP,MAAL,IAAe,IAAnB,EAAyB;AACvB,cAAM,IAAIO,KAAJ,CAAU,4DAAV,CAAN;AACD;AACF;;;qCAEiB;AAAA;;AAChB,aAAO,KAAKlB,KAAL,CAAWmB,IAAX,CAAgB,UAACjB,IAAD,EAAU;AAC/B,eAAO,KAAI,CAACkB,2BAAL,CAAiClB,IAAjC,CAAP;AACD,OAFM,CAAP;AAGD;;;gDAE4BA,I,EAAM;AACjC,aAAO,CAAC,CAAC,UAAD,EAAa,MAAb,EAAqB,MAArB,EAA6B,MAA7B,EAAqCmB,KAArC,CAA2C,UAACC,GAAD,EAAS;AAC1D,eAAOpB,IAAI,CAACC,cAAL,CAAoBmB,GAApB,CAAP;AACD,OAFO,CAAR;AAGD;;;6CAEyBvB,O,EAAS;AACjC,UAAIA,OAAO,CAACO,cAAZ,EAA4B;AAC1B,aAAKiB,OAAL,CAAaC,IAAb,CAAkB,gFAAlB;AACD;;AACD,UAAIzB,OAAO,CAAC0B,UAAZ,EAAwB;AACtB,aAAKF,OAAL,CAAaC,IAAb,CAAkB,oGAAlB;AACD;;AACD,UAAIzB,OAAO,CAAC2B,gBAAZ,EAA8B;AAC5B,aAAKH,OAAL,CAAaC,IAAb,CAAkB,0GAAlB;AACD;AACF;;;;;AAGHG,MAAM,CAACC,OAAP,GAAiB9B,aAAjB","sourcesContent":["'use strict'\n\nimport logger from 'loglevel'\n\nclass Configuration {\n  constructor (options = {}) {\n    this.nodes = options.nodes || []\n    this.nodes = this.nodes.map((node) => {\n      if (!node.hasOwnProperty('path')) {\n        node.path = ''\n      }\n      return node\n    })\n    this.connectionTimeoutSeconds = options.connectionTimeoutSeconds || options.timeoutSeconds || 10\n    this.healthcheckIntervalSeconds = options.healthcheckIntervalSeconds || 15\n    this.numRetries = options.numRetries || this.nodes.length || 3\n    this.retryIntervalSeconds = options.retryIntervalSeconds || 0.1\n    this.apiKey = options.apiKey\n\n    this.logger = options.logger || logger\n    this.logLevel = options.logLevel || 'warn'\n    this.logger.setLevel(this.logLevel)\n\n    this._showDeprecationWarnings(options)\n    this.validate()\n  }\n\n  validate () {\n    if (this.nodes == null || this.nodes.length === 0 || this._validateNodes()) {\n      throw new Error('Missing required configuration. Ensure that nodes[].protocol, nodes[].host and nodes[].port are set.')\n    }\n\n    if (this.apiKey == null) {\n      throw new Error('Missing required configuration. Ensure that apiKey is set.')\n    }\n  }\n\n  _validateNodes () {\n    return this.nodes.some((node) => {\n      return this._isNodeMissingAnyParameters(node)\n    })\n  }\n\n  _isNodeMissingAnyParameters (node) {\n    return !['protocol', 'host', 'port', 'path'].every((key) => {\n      return node.hasOwnProperty(key)\n    })\n  }\n\n  _showDeprecationWarnings (options) {\n    if (options.timeoutSeconds) {\n      this._logger.warn('Deprecation warning: timeoutSeconds is now renamed to connectionTimeoutSeconds')\n    }\n    if (options.masterNode) {\n      this._logger.warn('Deprecation warning: masterNode is now consolidated to nodes, starting with Typesense Server v0.12')\n    }\n    if (options.readReplicaNodes) {\n      this._logger.warn('Deprecation warning: readReplicaNodes is now consolidated to nodes, starting with Typesense Server v0.12')\n    }\n  }\n}\n\nmodule.exports = Configuration\n"],"file":"Configuration.js"}